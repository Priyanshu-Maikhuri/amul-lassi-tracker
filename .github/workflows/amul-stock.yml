name: Amul Lassi Stock Checker

on:
  schedule:
    - cron: "*/15 * * * *"   # runs every 15 minutes
  workflow_dispatch:        # allows manual run

jobs:
  check-stock:
    runs-on: ubuntu-latest

    steps:
      - name: Fetch product data from Amul API
        id: fetch
        run: |
          curl -s \
            -H "Accept: application/json" \
            "https://shop.amul.com/api/1/entity/ms.products?q=%7B%22alias%22:%22amul-high-protein-plain-lassi-200-ml-or-pack-of-30%22%7D&limit=1" \
            > response.json

      - name: Extract availability
        id: parse
        run: |
          AVAILABLE=$(jq '.data[0].available' response.json)
          echo "available=$AVAILABLE" >> $GITHUB_OUTPUT

      - name: Send Telegram alert if in stock
        if: steps.parse.outputs.available != '0'
        run: |
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
            -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
            -d parse_mode=Markdown \
            -d text="ðŸŸ¢ *Amul High Protein Lassi is IN STOCK!*%0A%0Ahttps://shop.amul.com/en/product/amul-high-protein-plain-lassi-200-ml-or-pack-of-30"
